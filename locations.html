<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Our Locations — O'Brien Immigration Law</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <nav class="navbar" id="globalNav">
    <!-- Rendered by renderGlobalNav() in main.js -->
  </nav>

  <main>
    <section class="locations-grid-section">
      <h2 class="reveal">Our Locations</h2>
      <p class="section-sub reveal">Visit us at one of our offices across California.</p>
      <div class="locations-card-grid" id="locationsGrid"></div>
    </section>

    <!-- Dynamic single-location detail (hidden by default, shown when ?loc= param) -->
    <div id="locationDetail" style="display:none">
      <section class="location-hero" id="locationHero">
        <div class="location-hero-content">
          <div class="location-hero-text">
            <h1 id="locationName" class="reveal"></h1>
            <p id="locationTagline" class="reveal"></p>
          </div>
          <div class="location-contact-card reveal">
            <h2>Contact</h2>
            <div id="locationContactInfo"></div>
          </div>
        </div>
      </section>

      <section class="location-bento-section">
        <div class="location-bento-grid">
          <div class="location-bento-card reveal">
            <div class="card-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
            </div>
            <h3>Parking & Access</h3>
            <p id="locationParking">Information about parking and building access.</p>
          </div>
          <div class="location-bento-card reveal">
            <div class="card-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            </div>
            <h3>Specialties</h3>
            <p id="locationSpecialties">Practice areas available at this location.</p>
          </div>
          <div class="location-bento-card location-form-card reveal">
            <div class="card-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            </div>
            <h3>Get in Touch</h3>
            <form action="https://formspree.io/f/mpqjddon" method="POST">
              <input type="hidden" name="_subject" id="locationFormSubject" value="Inquiry from Location Page">
              <input type="hidden" name="_next" value="thank-you.html">
              <div class="consult-form-group">
                <label for="locName">Name</label>
                <input type="text" id="locName" name="name" required placeholder="Your full name">
              </div>
              <div class="consult-form-group">
                <label for="locEmail">Email</label>
                <input type="email" id="locEmail" name="email" required placeholder="you@example.com">
              </div>
              <div class="consult-form-group">
                <label for="locMessage">Message</label>
                <textarea id="locMessage" name="message" placeholder="How can we help?" style="min-height:80px"></textarea>
              </div>
              <button type="submit" class="consult-submit">Send Message</button>
            </form>
          </div>
        </div>
      </section>
    </div>

    <footer class="footer">
      <div class="footer-links">
        <a href="index.html">Home</a>
        <a href="staff.html">Our Team</a>
        <a href="testimonials.html">Testimonials</a>
        <a href="locations.html">Locations</a>
      </div>
      <p>&copy; 2026 O'Brien Immigration Law. All rights reserved.</p>
    </footer>
  </main>

  <script src="analytics.js"></script>
  <script src="main.js"></script>
  <script>
    (function() {
      var locations = getLocations();
      var params = new URLSearchParams(window.location.search);
      var locId = params.get("loc");

      if (locId) {
        // Single location detail view
        var loc = locations.find(function(l) { return l.id === locId; });
        if (!loc) { window.location.href = "locations.html"; return; }

        document.querySelector(".locations-grid-section").style.display = "none";
        document.getElementById("locationDetail").style.display = "block";

        document.title = loc.name + " — O\u2019Brien Immigration Law";
        document.getElementById("locationName").textContent = loc.name;
        document.getElementById("locationTagline").textContent = loc.tagline || "O\u2019Brien Immigration Law";

        var locHeroEl = document.getElementById("locationHero");
        if (loc.cityPhoto) {
          // Set day image as default, store both for adaptive engine
          locHeroEl.style.backgroundImage = "url('" + loc.cityPhoto + "')";
          locHeroEl.dataset.dayPhoto = loc.cityPhoto;
          locHeroEl.dataset.nightPhoto = loc.cityPhotoNight || "";
        } else {
          locHeroEl.style.background = "linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)";
        }
        // Apply adaptive images for current theme (handles night mode on load)
        applyAdaptiveImages();

        var contactHtml = '';
        if (loc.address) {
          contactHtml += '<div class="location-contact-item">' +
            '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>' +
            '<span>' + escapeHtmlUtil(loc.address) + '</span>' +
          '</div>';
        }
        if (loc.phone) {
          contactHtml += '<div class="location-contact-item">' +
            '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>' +
            '<a href="tel:' + escapeHtmlUtil(loc.phone.replace(/[^+\d]/g, '')) + '">' + escapeHtmlUtil(loc.phone) + '</a>' +
          '</div>';
        }
        if (loc.email) {
          contactHtml += '<div class="location-contact-item">' +
            '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>' +
            '<a href="mailto:' + escapeHtmlUtil(loc.email) + '">' + escapeHtmlUtil(loc.email) + '</a>' +
          '</div>';
        }
        document.getElementById("locationContactInfo").innerHTML = contactHtml || '<span>Contact information coming soon.</span>';

        if (loc.parking) document.getElementById("locationParking").textContent = loc.parking;
        if (loc.specialties) document.getElementById("locationSpecialties").textContent = loc.specialties;
        document.getElementById("locationFormSubject").value = "Inquiry from " + loc.name + " Location Page";

        // Reveal animations
        document.getElementById("locationDetail").querySelectorAll(".reveal").forEach(function(el) {
          var obs = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
              if (entry.isIntersecting) {
                entry.target.classList.add("visible");
                obs.unobserve(entry.target);
              }
            });
          }, { threshold: 0.15 });
          obs.observe(el);
        });

      } else {
        // Locations grid view
        var grid = document.getElementById("locationsGrid");

        if (locations.length === 0) {
          grid.innerHTML = '<div class="location-empty">No locations yet. Check back soon!</div>';
          return;
        }

        var isDark = document.documentElement.getAttribute("data-theme") === "dark";
        grid.innerHTML = locations.map(function(loc) {
          var photo = loc.cityPhoto || "";
          var nightPhoto = loc.cityPhotoNight || "";
          var showPhoto = isDark && nightPhoto ? nightPhoto : photo;
          var needsFilter = isDark && !nightPhoto && photo;
          var photoStyle = showPhoto
            ? 'background-image:url(\'' + escapeHtmlUtil(showPhoto) + '\')' + (needsFilter ? ';filter:brightness(0.5) contrast(1.1)' : '')
            : 'background:linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)';

          return '<a href="locations.html?loc=' + encodeURIComponent(loc.id) + '" class="location-listing-card reveal">' +
            '<div class="location-listing-photo" style="' + photoStyle + '"></div>' +
            '<div class="location-listing-body">' +
              '<h3>' + escapeHtmlUtil(loc.name) + '</h3>' +
              '<p>' + escapeHtmlUtil(loc.address || loc.tagline || '') + '</p>' +
            '</div>' +
          '</a>';
        }).join('');

        grid.querySelectorAll(".reveal").forEach(function(el) {
          var obs = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
              if (entry.isIntersecting) {
                entry.target.classList.add("visible");
                obs.unobserve(entry.target);
              }
            });
          }, { threshold: 0.15 });
          obs.observe(el);
        });
      }
    })();
  </script>
</body>
</html>
