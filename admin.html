<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  <style>
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --white: #ffffff;
      --off-white: #f5f5f7;
      --light-gray: #e8e8ed;
      --mid-gray: #86868b;
      --dark: #1d1d1f;
      --danger: #d63031;
      --sidebar-w: 240px;
      --radius: 16px;
      --radius-sm: 12px;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--dark);
      background: var(--off-white);
      -webkit-font-smoothing: antialiased;
      display: flex;
      min-height: 100vh;
    }

    /* ── Sidebar ── */

    .sidebar {
      width: var(--sidebar-w);
      background: var(--white);
      border-right: 1px solid var(--light-gray);
      padding: 24px 0;
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      bottom: 0;
      overflow-y: auto;
    }

    .sidebar-logo {
      font-size: 1rem;
      font-weight: 600;
      padding: 0 24px 24px;
      border-bottom: 1px solid var(--light-gray);
      letter-spacing: -0.02em;
    }

    .sidebar-nav {
      list-style: none;
      padding: 16px 12px;
      flex: 1;
    }

    .sidebar-nav li a {
      display: block;
      padding: 10px 16px;
      font-size: 0.875rem;
      color: var(--mid-gray);
      text-decoration: none;
      border-radius: var(--radius-sm);
      transition: background 0.2s, color 0.2s;
      cursor: pointer;
    }

    .sidebar-nav li a:hover,
    .sidebar-nav li a.active {
      background: var(--off-white);
      color: var(--dark);
    }

    .sidebar-nav li a.active {
      font-weight: 500;
    }

    .sidebar-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--light-gray);
      font-size: 0.75rem;
      color: var(--mid-gray);
    }

    .sidebar-footer a {
      color: var(--mid-gray);
      text-decoration: none;
    }

    .sidebar-footer a:hover {
      color: var(--dark);
    }

    /* ── Main content ── */

    .main {
      margin-left: var(--sidebar-w);
      flex: 1;
      padding: 40px;
    }

    .main h1 {
      font-size: 1.75rem;
      font-weight: 600;
      letter-spacing: -0.03em;
      margin-bottom: 8px;
    }

    .main .subtitle {
      font-size: 0.9375rem;
      color: var(--mid-gray);
      margin-bottom: 40px;
    }

    /* ── Panels / Sections ── */

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    /* ── Stat cards ── */

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: var(--white);
      border-radius: var(--radius);
      padding: 28px 24px;
    }

    .stat-card .label {
      font-size: 0.8125rem;
      color: var(--mid-gray);
      margin-bottom: 8px;
    }

    .stat-card .value {
      font-size: 2rem;
      font-weight: 600;
      letter-spacing: -0.03em;
    }

    /* ── Table ── */

    .panel {
      background: var(--white);
      border-radius: var(--radius);
      padding: 28px;
      margin-bottom: 24px;
    }

    .panel h2 {
      font-size: 1.125rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      margin-bottom: 20px;
    }

    .panel table {
      width: 100%;
      border-collapse: collapse;
    }

    .panel th,
    .panel td {
      text-align: left;
      padding: 12px 0;
      font-size: 0.875rem;
      border-bottom: 1px solid var(--light-gray);
    }

    .panel th {
      color: var(--mid-gray);
      font-weight: 500;
    }

    .badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 980px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .badge.published {
      background: #e8f5e2;
      color: #2a7d2e;
    }

    .badge.draft {
      background: var(--light-gray);
      color: var(--mid-gray);
    }

    .badge.nav-badge {
      background: #e0ecff;
      color: #1a56db;
    }

    .badge.category-badge {
      background: #f0e6ff;
      color: #7c3aed;
    }

    .badge.footer-badge {
      background: #fef3e2;
      color: #b45309;
    }

    /* ── Forms ── */

    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--mid-gray);
      margin-bottom: 8px;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .form-group select,
    .form-group input[type="text"],
    .form-group input[type="date"],
    .form-group input[type="color"] {
      width: 100%;
      padding: 10px 14px;
      font-size: 0.9375rem;
      font-family: inherit;
      border: 1px solid var(--light-gray);
      border-radius: var(--radius-sm);
      background: var(--white);
      color: var(--dark);
      transition: border-color 0.2s;
    }

    .form-group textarea {
      width: 100%;
      padding: 12px 14px;
      font-size: 0.9375rem;
      font-family: inherit;
      border: 1px solid var(--light-gray);
      border-radius: var(--radius-sm);
      background: var(--white);
      color: var(--dark);
      resize: vertical;
      min-height: 160px;
      line-height: 1.6;
      transition: border-color 0.2s;
    }

    .form-group select:focus,
    .form-group input[type="text"]:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--mid-gray);
    }

    .form-group input[type="color"] {
      height: 44px;
      padding: 4px 6px;
      cursor: pointer;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .checkbox-row {
      display: flex;
      gap: 28px;
      margin-bottom: 24px;
    }

    .checkbox-row label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.875rem;
      color: var(--dark);
      cursor: pointer;
      text-transform: none;
      letter-spacing: 0;
      font-weight: 400;
    }

    .checkbox-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--dark);
      cursor: pointer;
    }

    /* ── Buttons ── */

    .btn {
      display: inline-block;
      padding: 10px 24px;
      font-size: 0.875rem;
      font-weight: 500;
      font-family: inherit;
      border: none;
      border-radius: 980px;
      cursor: pointer;
      transition: background 0.2s, transform 0.15s cubic-bezier(0.22, 1, 0.36, 1);
    }

    .btn:hover {
      transform: scale(0.97);
    }

    .btn:active {
      transform: scale(0.94);
    }

    .btn-primary {
      color: var(--white);
      background: var(--dark);
    }

    .btn-primary:hover {
      background: #000;
    }

    .btn-secondary {
      color: var(--dark);
      background: var(--off-white);
      border: 1px solid var(--light-gray);
    }

    .btn-danger {
      color: var(--white);
      background: var(--danger);
    }

    .btn-danger:hover {
      background: #b71c1c;
    }

    .btn-sm {
      padding: 6px 16px;
      font-size: 0.8125rem;
    }

    .btn-save {
      display: inline-block;
      padding: 12px 28px;
      font-size: 0.9375rem;
      font-weight: 500;
      font-family: inherit;
      color: var(--white);
      background: var(--dark);
      border: none;
      border-radius: 980px;
      cursor: pointer;
      transition: background 0.2s, transform 0.15s cubic-bezier(0.22, 1, 0.36, 1);
    }

    .btn-save:hover {
      background: #000;
      transform: scale(0.97);
    }

    .btn-save:active {
      transform: scale(0.94);
    }

    /* ── Page list ── */

    .page-list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .page-list-header h2 {
      margin-bottom: 0;
    }

    .page-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 0;
      border-bottom: 1px solid var(--light-gray);
    }

    .page-row:last-child {
      border-bottom: none;
    }

    .page-row-info {
      flex: 1;
      min-width: 0;
    }

    .page-row-title {
      font-size: 0.9375rem;
      font-weight: 500;
      margin-bottom: 2px;
    }

    .page-row-slug {
      font-size: 0.8125rem;
      color: var(--mid-gray);
    }

    .page-row-badges {
      display: flex;
      gap: 6px;
      margin-left: 16px;
      flex-shrink: 0;
    }

    .page-row-actions {
      display: flex;
      gap: 8px;
      margin-left: 16px;
      flex-shrink: 0;
    }

    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--mid-gray);
      font-size: 0.9375rem;
    }

    /* ── Page form panel ── */

    .page-form-panel {
      display: none;
    }

    .page-form-panel.visible {
      display: block;
    }

    /* ── Toast ── */

    .toast {
      position: fixed;
      bottom: 32px;
      right: 32px;
      background: var(--dark);
      color: var(--white);
      padding: 14px 24px;
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.3s, transform 0.3s;
      pointer-events: none;
      z-index: 200;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* ── Live preview ── */

    .preview-frame {
      width: 100%;
      height: 400px;
      border: 1px solid var(--light-gray);
      border-radius: var(--radius);
      margin-top: 24px;
    }

    /* ── Homepage Layout tiles ── */

    .tile-editor {
      background: var(--off-white);
      border-radius: var(--radius-sm);
      padding: 20px;
      margin-bottom: 20px;
    }

    .tile-editor h3 {
      font-size: 0.9375rem;
      font-weight: 600;
      margin-bottom: 16px;
      letter-spacing: -0.01em;
    }

    .tile-editor .form-group {
      margin-bottom: 16px;
    }

    .tile-editor .form-group:last-child {
      margin-bottom: 0;
    }

    .tile-editor textarea {
      min-height: 100px;
    }

    /* ── Media Library ── */

    .media-form {
      display: none;
      margin-bottom: 24px;
      padding: 20px;
      background: var(--off-white);
      border-radius: var(--radius-sm);
    }

    .media-form.visible {
      display: block;
    }

    .media-row {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 0;
      border-bottom: 1px solid var(--light-gray);
    }

    .media-row:last-child {
      border-bottom: none;
    }

    .media-thumb {
      width: 48px;
      height: 48px;
      object-fit: cover;
      border-radius: 8px;
      background: var(--light-gray);
      flex-shrink: 0;
    }

    .media-info {
      flex: 1;
      min-width: 0;
    }

    .media-label {
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 2px;
    }

    .media-url {
      font-size: 0.8125rem;
      color: var(--mid-gray);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 360px;
    }

    .media-actions {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }

    /* ── Responsive ── */

    @media (max-width: 768px) {
      .sidebar {
        width: 64px;
        --sidebar-w: 64px;
      }
      .sidebar-logo,
      .sidebar-nav li a span,
      .sidebar-footer {
        display: none;
      }
      .sidebar-nav li a {
        text-align: center;
      }
      .main {
        margin-left: 64px;
        padding: 24px;
      }
      .form-row {
        grid-template-columns: 1fr;
      }
      .page-row {
        flex-wrap: wrap;
        gap: 8px;
      }
      .page-row-badges {
        margin-left: 0;
      }
      .page-row-actions {
        margin-left: 0;
      }
      .media-url {
        max-width: 140px;
      }
    }
  </style>
</head>
<body>

  <aside class="sidebar">
    <div class="sidebar-logo">Admin</div>
    <ul class="sidebar-nav">
      <li><a data-section="dashboard" class="active"><span>Dashboard</span></a></li>
      <li><a data-section="settings"><span>Site Settings</span></a></li>
      <li><a data-section="homepage"><span>Homepage Layout</span></a></li>
      <li><a data-section="pages"><span>Pages</span></a></li>
      <li><a data-section="posts"><span>Posts</span></a></li>
      <li><a data-section="staff"><span>Staff</span></a></li>
      <li><a data-section="media"><span>Media</span></a></li>
    </ul>
    <div class="sidebar-footer">
      <a href="index.html">&larr; Back to site</a>
    </div>
  </aside>

  <div class="main">

    <!-- ── Dashboard ── -->
    <div id="dashboard" class="section active">
      <h1>Dashboard</h1>
      <p class="subtitle">Overview of your site activity.</p>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="label">Total Pages</div>
          <div class="value" id="statPages">0</div>
        </div>
        <div class="stat-card">
          <div class="label">Published</div>
          <div class="value" id="statPublished">0</div>
        </div>
        <div class="stat-card">
          <div class="label">Nav Links</div>
          <div class="value" id="statNav">0</div>
        </div>
        <div class="stat-card">
          <div class="label">Footer Links</div>
          <div class="value" id="statFooter">0</div>
        </div>
        <div class="stat-card">
          <div class="label">Staff Members</div>
          <div class="value" id="statStaff">0</div>
        </div>
        <div class="stat-card">
          <div class="label">Published Posts</div>
          <div class="value" id="statPosts">0</div>
        </div>
      </div>

      <div class="panel">
        <h2>Recent Content</h2>
        <table>
          <thead>
            <tr>
              <th>Title</th>
              <th>Type</th>
              <th>Status</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="dashboardRecent">
            <tr>
              <td colspan="4" class="empty-state" style="padding:24px 0">No pages yet. Go to Pages to create one.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ── Site Settings ── -->
    <div id="settings" class="section">
      <h1>Site Settings</h1>
      <p class="subtitle">Customize fonts, colors, and the hero background. Changes are saved to localStorage and apply across the site.</p>

      <div class="panel">
        <h2>Typography</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="primaryFont">Primary Font</label>
            <select id="primaryFont">
              <option value="'Inter', system-ui, -apple-system, sans-serif">Inter (Default)</option>
              <option value="'SF Pro Display', system-ui, -apple-system, sans-serif">SF Pro Display</option>
              <option value="Georgia, 'Times New Roman', serif">Georgia</option>
              <option value="'Courier New', Courier, monospace">Courier New</option>
              <option value="system-ui, sans-serif">System UI</option>
            </select>
          </div>
          <div class="form-group">
            <label for="headingFont">Heading Font</label>
            <select id="headingFont">
              <option value="'Inter', system-ui, -apple-system, sans-serif">Inter (Default)</option>
              <option value="'SF Pro Display', system-ui, -apple-system, sans-serif">SF Pro Display</option>
              <option value="Georgia, 'Times New Roman', serif">Georgia</option>
              <option value="'Courier New', Courier, monospace">Courier New</option>
              <option value="system-ui, sans-serif">System UI</option>
            </select>
          </div>
        </div>
      </div>

      <div class="panel">
        <h2>Colors</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="accentColor">Accent Color</label>
            <input type="color" id="accentColor" value="#1d1d1f">
          </div>
          <div class="form-group"></div>
        </div>
      </div>

      <div class="panel">
        <h2>Hero Background</h2>
        <div class="form-group">
          <label for="heroImage">Image URL</label>
          <input type="text" id="heroImage" placeholder="https://example.com/hero.jpg">
        </div>
      </div>

      <div class="panel">
        <h2>Button Style</h2>
        <div class="form-group">
          <label for="btnStyleSelect">Style</label>
          <select id="btnStyleSelect">
            <option value="pill">Pill (Rounded, Apple-esque)</option>
            <option value="modern">Modern (8px rounding)</option>
            <option value="glass">Glass (Semi-transparent + border)</option>
          </select>
        </div>
      </div>

      <div class="panel">
        <h2>Consultation Pop-up</h2>
        <div class="checkbox-row">
          <label>
            <input type="checkbox" id="consultPopupEnabled" checked>
            Enable Consultation Pop-up
          </label>
        </div>
      </div>

      <button class="btn-save" id="saveSettings">Save Settings</button>

      <iframe id="previewFrame" class="preview-frame" src="index.html" title="Live Preview"></iframe>
    </div>

    <!-- ── Homepage Layout ── -->
    <div id="homepage" class="section">
      <h1>Homepage Layout</h1>
      <p class="subtitle">Configure the bento tiles displayed on the homepage (up to 5 tiles).</p>

      <div class="panel">
        <div class="page-list-header">
          <h2>Bento Tiles</h2>
          <button class="btn btn-primary btn-sm" id="btnAddTile">Add Tile</button>
        </div>

        <div id="bentoTileEditors"></div>

        <button class="btn-save" id="saveBentoTiles">Save Layout</button>
      </div>

      <div class="panel" style="margin-top:24px">
        <h2>Preview</h2>
        <p class="subtitle" style="margin-bottom:16px">Live preview of your bento grid layout.</p>
        <div id="bentoPreview" style="display:grid;grid-template-columns:repeat(12,1fr);grid-auto-rows:1fr;grid-auto-flow:dense;gap:12px;max-width:100%"></div>
      </div>
    </div>

    <!-- ── Pages ── -->
    <div id="pages" class="section">
      <h1>Pages</h1>
      <p class="subtitle">Create and manage site pages. Pages can appear in the top navigation, footer, or both.</p>

      <!-- Page list -->
      <div class="panel" id="pageListPanel">
        <div class="page-list-header">
          <h2>All Pages</h2>
          <button class="btn btn-primary btn-sm" id="btnAddPage">Add New Page</button>
        </div>
        <div id="pageList">
          <div class="empty-state">No pages yet. Click "Add New Page" to get started.</div>
        </div>
      </div>

      <!-- Page form (add / edit) -->
      <div class="panel page-form-panel" id="pageFormPanel">
        <h2 id="pageFormTitle">Add New Page</h2>
        <input type="hidden" id="pageEditId" value="">

        <div class="form-row">
          <div class="form-group">
            <label for="pageTitleInput">Page Title</label>
            <input type="text" id="pageTitleInput" placeholder="About Us">
          </div>
          <div class="form-group">
            <label for="pageSlugInput">URL Slug</label>
            <input type="text" id="pageSlugInput" placeholder="about">
          </div>
        </div>

        <div class="form-group">
          <label for="pageContentInput">Content</label>
          <textarea id="pageContentInput" placeholder="Write your page content here..."></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="pageSeoTitle">SEO Title</label>
            <input type="text" id="pageSeoTitle" placeholder="Custom title for search engines">
          </div>
          <div class="form-group">
            <label for="pageMetaDesc">Meta Description</label>
            <input type="text" id="pageMetaDesc" placeholder="Brief description for search results">
          </div>
        </div>

        <div class="checkbox-row">
          <label>
            <input type="checkbox" id="pageShowNav">
            Show in Top Navigation
          </label>
          <label>
            <input type="checkbox" id="pageShowFooter">
            Show in Footer
          </label>
          <label>
            <input type="checkbox" id="pagePublished">
            Published
          </label>
        </div>

        <div style="display:flex;gap:12px">
          <button class="btn btn-primary" id="btnSavePage">Save Page</button>
          <button class="btn btn-secondary" id="btnCancelPage">Cancel</button>
        </div>
      </div>
    </div>

    <!-- ── Posts ── -->
    <div id="posts" class="section">
      <h1>Posts</h1>
      <p class="subtitle">Manage your blog posts.</p>

      <!-- Post list -->
      <div class="panel" id="postListPanel">
        <div class="page-list-header">
          <h2>All Posts</h2>
          <button class="btn btn-primary btn-sm" id="btnAddPost">Add New Post</button>
        </div>
        <div id="postList">
          <div class="empty-state">No posts yet. Click "Add New Post" to get started.</div>
        </div>
      </div>

      <!-- Post form (add / edit) -->
      <div class="panel page-form-panel" id="postFormPanel">
        <h2 id="postFormTitle">Add New Post</h2>
        <input type="hidden" id="postEditId" value="">

        <div class="form-row">
          <div class="form-group">
            <label for="postTitleInput">Title</label>
            <input type="text" id="postTitleInput" placeholder="Post title">
          </div>
          <div class="form-group">
            <label for="postSlugInput">Slug</label>
            <input type="text" id="postSlugInput" placeholder="post-slug">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="postDateInput">Date</label>
            <input type="date" id="postDateInput">
          </div>
          <div class="form-group">
            <label for="postCategoryInput">Category</label>
            <select id="postCategoryInput">
              <option value="News">News</option>
              <option value="Policy Update">Policy Update</option>
              <option value="Case Study">Case Study</option>
              <option value="Community">Community</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="postContentInput">Content</label>
          <textarea id="postContentInput" placeholder="Write your post content here..." style="min-height:240px"></textarea>
        </div>

        <div class="checkbox-row">
          <label>
            <input type="checkbox" id="postPublished" checked>
            Published
          </label>
        </div>

        <div style="display:flex;gap:12px">
          <button class="btn btn-primary" id="btnSavePost">Save Post</button>
          <button class="btn btn-secondary" id="btnCancelPost">Cancel</button>
        </div>
      </div>
    </div>

    <!-- ── Staff ── -->
    <div id="staff" class="section">
      <h1>Staff</h1>
      <p class="subtitle">Manage your team members.</p>

      <!-- Staff list -->
      <div class="panel" id="staffListPanel">
        <div class="page-list-header">
          <h2>All Staff</h2>
          <button class="btn btn-primary btn-sm" id="btnAddStaff">Add Staff Member</button>
        </div>
        <div id="staffList">
          <div class="empty-state">No staff yet. Click "Add Staff Member" to get started.</div>
        </div>
      </div>

      <!-- Staff form (add / edit) -->
      <div class="panel page-form-panel" id="staffFormPanel">
        <h2 id="staffFormTitle">Add Staff Member</h2>
        <input type="hidden" id="staffEditId" value="">

        <div class="form-row">
          <div class="form-group">
            <label for="staffNameInput">Name</label>
            <input type="text" id="staffNameInput" placeholder="Full name">
          </div>
          <div class="form-group">
            <label for="staffTitleInput">Title</label>
            <input type="text" id="staffTitleInput" placeholder="Senior Attorney">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="staffOfficeInput">Office Location</label>
            <select id="staffOfficeInput">
              <option value="Berkeley">Berkeley</option>
              <option value="Stockton">Stockton</option>
            </select>
          </div>
          <div class="form-group">
            <label for="staffImageInput">Image URL</label>
            <input type="text" id="staffImageInput" placeholder="https://example.com/photo.jpg">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="staffEmailInput">Direct Email</label>
            <input type="email" id="staffEmailInput" placeholder="name@obrienimmigration.com">
          </div>
          <div class="form-group">
            <label for="staffPhoneInput">Direct Phone</label>
            <input type="tel" id="staffPhoneInput" placeholder="(510) 555-0100">
          </div>
        </div>

        <div class="form-group">
          <label for="staffBioInput">Bio</label>
          <textarea id="staffBioInput" placeholder="Staff member bio..."></textarea>
        </div>

        <div class="checkbox-row">
          <label>
            <input type="checkbox" id="staffShowOnWebsite" checked>
            Show on Website
          </label>
        </div>

        <div class="checkbox-row">
          <label>
            <input type="checkbox" id="staffHiring">
            Actively Hiring
          </label>
        </div>

        <div style="display:flex;gap:12px">
          <button class="btn btn-primary" id="btnSaveStaff">Save Staff Member</button>
          <button class="btn btn-secondary" id="btnCancelStaff">Cancel</button>
        </div>
      </div>
    </div>

    <div id="media" class="section">
      <h1>Media</h1>
      <p class="subtitle">Manage your media library. Add image URLs and organize them with labels.</p>

      <div class="panel">
        <div class="page-list-header">
          <h2>Media Library</h2>
          <button class="btn btn-primary btn-sm" id="btnAddMedia">Add Image URL</button>
        </div>

        <div class="media-form" id="mediaForm">
          <div class="form-group">
            <label for="mediaUrlInput">Image URL</label>
            <input type="text" id="mediaUrlInput" placeholder="https://example.com/image.jpg">
          </div>
          <div class="form-group">
            <label for="mediaLabelInput">Label / Alt Text</label>
            <input type="text" id="mediaLabelInput" placeholder="Descriptive label for this image">
          </div>
          <div style="display:flex;gap:12px">
            <button class="btn btn-primary btn-sm" id="btnSaveMedia">Save</button>
            <button class="btn btn-secondary btn-sm" id="btnCancelMedia">Cancel</button>
          </div>
        </div>

        <div id="mediaList">
          <div class="empty-state">No media yet. Click "Add Image URL" to get started.</div>
        </div>
      </div>
    </div>

  </div>

  <div class="toast" id="toast"></div>

  <script>
    /* ══════════════════════════════════════════════
       Helpers
       ══════════════════════════════════════════════ */

    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2000);
    }

    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
    }

    function escapeHtml(str) {
      const div = document.createElement("div");
      div.textContent = str;
      return div.innerHTML;
    }

    /* ══════════════════════════════════════════════
       Sidebar navigation
       ══════════════════════════════════════════════ */

    const sidebarLinks = document.querySelectorAll("[data-section]");
    const sections = document.querySelectorAll(".section");

    sidebarLinks.forEach((link) => {
      link.addEventListener("click", () => {
        sidebarLinks.forEach((l) => l.classList.remove("active"));
        sections.forEach((s) => s.classList.remove("active"));
        link.classList.add("active");
        document.getElementById(link.dataset.section).classList.add("active");
      });
    });

    /* ══════════════════════════════════════════════
       Page data (localStorage)
       ══════════════════════════════════════════════ */

    function getPages() {
      return JSON.parse(localStorage.getItem("sitePages") || "[]");
    }

    function savePages(pages) {
      localStorage.setItem("sitePages", JSON.stringify(pages));
    }

    /* ══════════════════════════════════════════════
       Post data (localStorage)
       ══════════════════════════════════════════════ */

    function getPosts() {
      return JSON.parse(localStorage.getItem("sitePosts") || "[]");
    }

    function savePosts(posts) {
      localStorage.setItem("sitePosts", JSON.stringify(posts));
    }

    /* ══════════════════════════════════════════════
       Staff data (localStorage)
       ══════════════════════════════════════════════ */

    function getStaff() {
      return JSON.parse(localStorage.getItem("siteStaff") || "[]");
    }

    function saveStaff(staff) {
      localStorage.setItem("siteStaff", JSON.stringify(staff));
    }

    /* ══════════════════════════════════════════════
       Dashboard stats
       ══════════════════════════════════════════════ */

    function refreshDashboard() {
      const pages = getPages();
      const posts = getPosts();
      const staff = getStaff();
      document.getElementById("statPages").textContent = pages.length;
      document.getElementById("statPublished").textContent = pages.filter((p) => p.published !== false).length;
      document.getElementById("statNav").textContent = pages.filter((p) => p.showInNav && p.published !== false).length;
      document.getElementById("statFooter").textContent = pages.filter((p) => p.showInFooter && p.published !== false).length;
      document.getElementById("statStaff").textContent = staff.length;
      document.getElementById("statPosts").textContent = posts.filter((p) => p.published).length;

      const tbody = document.getElementById("dashboardRecent");
      // Combine pages and posts for recent content
      const allContent = [];
      pages.forEach((p) => {
        allContent.push({ title: p.title, type: 'Page', published: p.published !== false, date: p.createdAt || '\u2014', showInNav: p.showInNav, showInFooter: p.showInFooter });
      });
      posts.forEach((p) => {
        allContent.push({ title: p.title, type: 'Post', published: p.published, date: p.date || p.createdAt || '\u2014', category: p.category });
      });

      if (allContent.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="empty-state" style="padding:24px 0">No content yet. Go to Pages or Posts to create some.</td></tr>';
        return;
      }
      const recent = allContent.reverse().slice(0, 8);
      tbody.innerHTML = recent.map((item) => {
        const badges = [];
        if (item.published) {
          badges.push('<span class="badge published">Published</span>');
        } else {
          badges.push('<span class="badge draft">Draft</span>');
        }
        if (item.showInNav) badges.push('<span class="badge nav-badge">Nav</span>');
        if (item.showInFooter) badges.push('<span class="badge footer-badge">Footer</span>');
        if (item.category) badges.push('<span class="badge category-badge">' + escapeHtml(item.category) + '</span>');
        return '<tr>' +
          '<td>' + escapeHtml(item.title) + '</td>' +
          '<td>' + item.type + '</td>' +
          '<td>' + badges.join(' ') + '</td>' +
          '<td>' + escapeHtml(item.date) + '</td>' +
          '</tr>';
      }).join('');
    }

    /* ══════════════════════════════════════════════
       Pages list
       ══════════════════════════════════════════════ */

    function renderPageList() {
      const container = document.getElementById("pageList");
      const pages = getPages();

      if (pages.length === 0) {
        container.innerHTML = '<div class="empty-state">No pages yet. Click "Add New Page" to get started.</div>';
        return;
      }

      container.innerHTML = pages.map((p) => {
        const badges = [];
        const isPublished = p.published !== false;
        if (isPublished) {
          badges.push('<span class="badge published">Published</span>');
        } else {
          badges.push('<span class="badge draft">Draft</span>');
        }
        if (p.showInNav) badges.push('<span class="badge nav-badge">Nav</span>');
        if (p.showInFooter) badges.push('<span class="badge footer-badge">Footer</span>');
        return '<div class="page-row" data-id="' + p.id + '">' +
          '<div class="page-row-info">' +
            '<div class="page-row-title">' + escapeHtml(p.title) + '</div>' +
            '<div class="page-row-slug">/' + escapeHtml(p.slug) + '</div>' +
          '</div>' +
          '<div class="page-row-badges">' + badges.join('') + '</div>' +
          '<div class="page-row-actions">' +
            '<button class="btn btn-secondary btn-sm btn-edit-page">Edit</button>' +
            '<button class="btn btn-danger btn-sm btn-delete-page">Delete</button>' +
          '</div>' +
        '</div>';
      }).join('');

      // Bind edit buttons
      container.querySelectorAll(".btn-edit-page").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.closest(".page-row").dataset.id;
          editPage(id);
        });
      });

      // Bind delete buttons
      container.querySelectorAll(".btn-delete-page").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.closest(".page-row").dataset.id;
          deletePage(id);
        });
      });
    }

    /* ══════════════════════════════════════════════
       Page form (add / edit)
       ══════════════════════════════════════════════ */

    const pageFormPanel = document.getElementById("pageFormPanel");
    const pageListPanel = document.getElementById("pageListPanel");

    function showPageForm() {
      pageFormPanel.classList.add("visible");
      pageListPanel.style.display = "none";
    }

    function hidePageForm() {
      pageFormPanel.classList.remove("visible");
      pageListPanel.style.display = "";
      clearPageForm();
    }

    function clearPageForm() {
      document.getElementById("pageEditId").value = "";
      document.getElementById("pageTitleInput").value = "";
      document.getElementById("pageSlugInput").value = "";
      document.getElementById("pageContentInput").value = "";
      document.getElementById("pageSeoTitle").value = "";
      document.getElementById("pageMetaDesc").value = "";
      document.getElementById("pageShowNav").checked = false;
      document.getElementById("pageShowFooter").checked = false;
      document.getElementById("pagePublished").checked = true;
      document.getElementById("pageFormTitle").textContent = "Add New Page";
    }

    // Auto-generate slug from title
    document.getElementById("pageTitleInput").addEventListener("input", (e) => {
      const slugField = document.getElementById("pageSlugInput");
      const editId = document.getElementById("pageEditId").value;
      // Only auto-fill slug when creating new pages
      if (!editId) {
        slugField.value = e.target.value
          .toLowerCase()
          .replace(/[^a-z0-9\s-]/g, "")
          .replace(/\s+/g, "-")
          .replace(/-+/g, "-")
          .replace(/^-|-$/g, "");
      }
    });

    document.getElementById("btnAddPage").addEventListener("click", () => {
      clearPageForm();
      showPageForm();
    });

    document.getElementById("btnCancelPage").addEventListener("click", hidePageForm);

    document.getElementById("btnSavePage").addEventListener("click", () => {
      const title = document.getElementById("pageTitleInput").value.trim();
      const slug = document.getElementById("pageSlugInput").value.trim()
        .toLowerCase().replace(/[^a-z0-9-]/g, "");
      const content = document.getElementById("pageContentInput").value;
      const seoTitle = document.getElementById("pageSeoTitle").value.trim();
      const metaDescription = document.getElementById("pageMetaDesc").value.trim();
      const showInNav = document.getElementById("pageShowNav").checked;
      const showInFooter = document.getElementById("pageShowFooter").checked;
      const published = document.getElementById("pagePublished").checked;
      const editId = document.getElementById("pageEditId").value;

      if (!title) { showToast("Title is required"); return; }
      if (!slug) { showToast("Slug is required"); return; }

      const pages = getPages();

      // Check for duplicate slug
      const duplicate = pages.find((p) => p.slug === slug && p.id !== editId);
      if (duplicate) { showToast("A page with this slug already exists"); return; }

      if (editId) {
        // Update existing
        const idx = pages.findIndex((p) => p.id === editId);
        if (idx !== -1) {
          pages[idx].title = title;
          pages[idx].slug = slug;
          pages[idx].content = content;
          pages[idx].seoTitle = seoTitle;
          pages[idx].metaDescription = metaDescription;
          pages[idx].showInNav = showInNav;
          pages[idx].showInFooter = showInFooter;
          pages[idx].published = published;
        }
        showToast("Page updated");
      } else {
        // Create new
        const now = new Date();
        const dateStr = now.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" });
        pages.push({
          id: generateId(),
          title: title,
          slug: slug,
          content: content,
          seoTitle: seoTitle,
          metaDescription: metaDescription,
          showInNav: showInNav,
          showInFooter: showInFooter,
          published: published,
          createdAt: dateStr
        });
        showToast("Page created");
      }

      savePages(pages);
      hidePageForm();
      renderPageList();
      refreshDashboard();
      console.log("Pages saved:", pages);
    });

    function editPage(id) {
      const pages = getPages();
      const page = pages.find((p) => p.id === id);
      if (!page) return;

      document.getElementById("pageEditId").value = page.id;
      document.getElementById("pageTitleInput").value = page.title;
      document.getElementById("pageSlugInput").value = page.slug;
      document.getElementById("pageContentInput").value = page.content;
      document.getElementById("pageSeoTitle").value = page.seoTitle || "";
      document.getElementById("pageMetaDesc").value = page.metaDescription || "";
      document.getElementById("pageShowNav").checked = page.showInNav;
      document.getElementById("pageShowFooter").checked = page.showInFooter;
      document.getElementById("pagePublished").checked = page.published !== false;
      document.getElementById("pageFormTitle").textContent = "Edit Page";

      showPageForm();
    }

    function deletePage(id) {
      const pages = getPages();
      const page = pages.find((p) => p.id === id);
      if (!page) return;

      if (!confirm('Delete "' + page.title + '"? This cannot be undone.')) return;

      const updated = pages.filter((p) => p.id !== id);
      savePages(updated);
      renderPageList();
      refreshDashboard();
      showToast("Page deleted");
    }

    /* ══════════════════════════════════════════════
       Site Settings (existing)
       ══════════════════════════════════════════════ */

    const saved = JSON.parse(localStorage.getItem("siteSettings") || "{}");

    const primaryFontSelect = document.getElementById("primaryFont");
    const headingFontSelect = document.getElementById("headingFont");
    const accentColorInput = document.getElementById("accentColor");
    const heroImageInput = document.getElementById("heroImage");

    const consultToggle = document.getElementById("consultPopupEnabled");
    const btnStyleSelect = document.getElementById("btnStyleSelect");

    if (saved["--primary-font"]) primaryFontSelect.value = saved["--primary-font"];
    if (saved["--heading-font"]) headingFontSelect.value = saved["--heading-font"];
    if (saved["--accent-color"]) accentColorInput.value = saved["--accent-color"];
    if (saved["--hero-bg-image"]) {
      const url = saved["--hero-bg-image"].replace(/^url\(["']?/, "").replace(/["']?\)$/, "");
      if (url !== "none") heroImageInput.value = url;
    }
    if (saved["--btn-style"]) btnStyleSelect.value = saved["--btn-style"];
    if (saved["--consult-popup"] === "disabled") {
      consultToggle.checked = false;
    }

    document.getElementById("saveSettings").addEventListener("click", () => {
      const heroUrl = heroImageInput.value.trim();

      const settings = {
        "--primary-font": primaryFontSelect.value,
        "--heading-font": headingFontSelect.value,
        "--accent-color": accentColorInput.value,
        "--hero-bg-image": heroUrl ? "url('" + heroUrl + "')" : "none",
        "--btn-style": btnStyleSelect.value,
        "--consult-popup": consultToggle.checked ? "enabled" : "disabled",
      };

      localStorage.setItem("siteSettings", JSON.stringify(settings));
      console.log("Site settings saved:", settings);

      const preview = document.getElementById("previewFrame");
      if (preview) preview.src = preview.src;

      showToast("Settings saved");
    });

    /* ══════════════════════════════════════════════
       Homepage Layout — Dynamic Bento Tiles
       ══════════════════════════════════════════════ */

    const ICON_OPTIONS = ["scale", "shield", "users", "document"];
    const ICON_LABELS = { scale: "Scale", shield: "Shield", users: "Users", document: "Document" };
    const PREVIEW_ICON_MAP = {
      scale: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18"/><path d="M4 7l8-4 8 4"/><path d="M1 14l3-7 3 7a4.24 4.24 0 0 1-6 0z"/><path d="M17 14l3-7 3 7a4.24 4.24 0 0 1-6 0z"/></svg>',
      shield: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',
      users: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
      document: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>'
    };
    const MAX_TILES = 5;

    function getDefaultBentoTiles() {
      return [
        { id: generateId(), title: "Family Petitions", description: "", icon: "users", layout: "large", displayMode: "icon", bgImage: "" },
        { id: generateId(), title: "Removal Defense", description: "", icon: "shield", layout: "medium", displayMode: "icon", bgImage: "" },
        { id: generateId(), title: "Citizenship", description: "", icon: "document", layout: "small", displayMode: "icon", bgImage: "" }
      ];
    }

    function loadBentoTiles() {
      const stored = localStorage.getItem("bentoTiles");
      if (stored) {
        try {
          const parsed = JSON.parse(stored);
          if (!Array.isArray(parsed)) {
            const arr = [];
            if (parsed.tile1) arr.push({ id: generateId(), title: parsed.tile1.title || "", description: parsed.tile1.description || "", icon: parsed.tile1.icon || "users", layout: "large", displayMode: "icon", bgImage: "" });
            if (parsed.tile2) arr.push({ id: generateId(), title: parsed.tile2.title || "", description: parsed.tile2.description || "", icon: parsed.tile2.icon || "shield", layout: "medium", displayMode: "icon", bgImage: "" });
            if (parsed.tile3) arr.push({ id: generateId(), title: parsed.tile3.title || "", description: parsed.tile3.description || "", icon: parsed.tile3.icon || "document", layout: "small", displayMode: "icon", bgImage: "" });
            return arr;
          }
          // Ensure displayMode exists on migrated tiles
          return parsed.map(t => ({ displayMode: "icon", bgImage: "", ...t }));
        } catch (e) {
          return getDefaultBentoTiles();
        }
      }
      return getDefaultBentoTiles();
    }

    function renderBentoEditors() {
      const tiles = loadBentoTiles();
      const container = document.getElementById("bentoTileEditors");
      const addBtn = document.getElementById("btnAddTile");
      addBtn.disabled = tiles.length >= MAX_TILES;

      if (tiles.length === 0) {
        container.innerHTML = '<div class="empty-state">No tiles yet. Click "Add Tile" to get started.</div>';
        renderBentoPreview();
        return;
      }

      container.innerHTML = tiles.map((tile, idx) => {
        const iconOptions = ICON_OPTIONS.map((ic) =>
          '<option value="' + ic + '"' + (tile.icon === ic ? ' selected' : '') + '>' + ICON_LABELS[ic] + '</option>'
        ).join('');
        const sizeOptions = ["small", "medium", "large"].map((s) =>
          '<option value="' + s + '"' + (tile.layout === s ? ' selected' : '') + '>' + s.charAt(0).toUpperCase() + s.slice(1) + '</option>'
        ).join('');
        const isIcon = tile.displayMode !== "image";
        return '<div class="tile-editor" data-tile-id="' + tile.id + '">' +
          '<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">' +
            '<h3>Tile ' + (idx + 1) + '</h3>' +
            '<button class="btn btn-danger btn-sm btn-remove-tile">Remove</button>' +
          '</div>' +
          '<div class="form-group">' +
            '<label>Title</label>' +
            '<input type="text" class="tile-title-input" value="' + escapeHtml(tile.title || '') + '" placeholder="Tile title">' +
          '</div>' +
          '<div class="form-group">' +
            '<label>Description</label>' +
            '<textarea class="tile-desc-input" placeholder="Tile description">' + escapeHtml(tile.description || '') + '</textarea>' +
          '</div>' +
          '<div class="form-group">' +
            '<label>Display Mode</label>' +
            '<div style="display:flex;gap:12px;margin-top:4px">' +
              '<label style="display:flex;align-items:center;gap:6px;font-size:0.875rem;font-weight:400;text-transform:none;letter-spacing:normal;cursor:pointer">' +
                '<input type="radio" name="displayMode_' + tile.id + '" value="icon" class="tile-mode-input"' + (isIcon ? ' checked' : '') + '> Use Icon' +
              '</label>' +
              '<label style="display:flex;align-items:center;gap:6px;font-size:0.875rem;font-weight:400;text-transform:none;letter-spacing:normal;cursor:pointer">' +
                '<input type="radio" name="displayMode_' + tile.id + '" value="image" class="tile-mode-input"' + (!isIcon ? ' checked' : '') + '> Use Background Image' +
              '</label>' +
            '</div>' +
          '</div>' +
          '<div class="tile-icon-group" style="' + (isIcon ? '' : 'display:none') + '">' +
            '<div class="form-group">' +
              '<label>Icon</label>' +
              '<select class="tile-icon-input">' + iconOptions + '</select>' +
            '</div>' +
          '</div>' +
          '<div class="tile-image-group" style="' + (!isIcon ? '' : 'display:none') + '">' +
            '<div class="form-group">' +
              '<label>Background Image URL</label>' +
              '<input type="text" class="tile-bgimage-input" value="' + escapeHtml(tile.bgImage || '') + '" placeholder="https://images.unsplash.com/...">' +
            '</div>' +
          '</div>' +
          '<div class="form-group">' +
            '<label>Tile Size</label>' +
            '<select class="tile-size-input">' + sizeOptions + '</select>' +
          '</div>' +
        '</div>';
      }).join('');

      // Bind remove buttons
      container.querySelectorAll(".btn-remove-tile").forEach((btn) => {
        btn.addEventListener("click", () => {
          const tileId = btn.closest(".tile-editor").dataset.tileId;
          let tiles = loadBentoTiles();
          tiles = tiles.filter((t) => t.id !== tileId);
          localStorage.setItem("bentoTiles", JSON.stringify(tiles));
          renderBentoEditors();
          showToast("Tile removed");
        });
      });

      // Bind display mode toggles
      container.querySelectorAll(".tile-mode-input").forEach((radio) => {
        radio.addEventListener("change", () => {
          const editor = radio.closest(".tile-editor");
          const isIcon = radio.value === "icon";
          editor.querySelector(".tile-icon-group").style.display = isIcon ? "" : "none";
          editor.querySelector(".tile-image-group").style.display = isIcon ? "none" : "";
          renderBentoPreview();
        });
      });

      // Bind live preview updates on any input change
      container.querySelectorAll("input, textarea, select").forEach((el) => {
        el.addEventListener("input", () => renderBentoPreview());
        el.addEventListener("change", () => renderBentoPreview());
      });

      renderBentoPreview();
    }

    function collectTilesFromEditors() {
      const editors = document.querySelectorAll("#bentoTileEditors .tile-editor");
      const tiles = [];
      editors.forEach((editor) => {
        const modeRadio = editor.querySelector('.tile-mode-input:checked');
        const displayMode = modeRadio ? modeRadio.value : "icon";
        tiles.push({
          id: editor.dataset.tileId,
          title: editor.querySelector(".tile-title-input").value.trim(),
          description: editor.querySelector(".tile-desc-input").value,
          icon: editor.querySelector(".tile-icon-input").value,
          layout: editor.querySelector(".tile-size-input").value,
          displayMode: displayMode,
          bgImage: editor.querySelector(".tile-bgimage-input") ? editor.querySelector(".tile-bgimage-input").value.trim() : ""
        });
      });
      return tiles;
    }

    function renderBentoPreview() {
      const preview = document.getElementById("bentoPreview");
      if (!preview) return;
      const tiles = collectTilesFromEditors();
      const sizeMap = { small: "span 3", medium: "span 6", large: "span 12" };
      const heightMap = { small: "100px", medium: "120px", large: "140px" };

      preview.innerHTML = tiles.map((tile) => {
        const span = sizeMap[tile.layout] || "span 1";
        const h = heightMap[tile.layout] || "120px";
        const isImage = tile.displayMode === "image" && tile.bgImage;

        if (isImage) {
          return '<div style="grid-column:' + span + ';min-height:' + h + ';border-radius:16px;overflow:hidden;position:relative;background:url(\'' + escapeHtml(tile.bgImage) + '\') center/cover">' +
            '<div style="position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.25),rgba(0,0,0,0.6));backdrop-filter:blur(2px);border-radius:inherit"></div>' +
            '<div style="position:relative;z-index:1;padding:16px;display:flex;flex-direction:column;justify-content:flex-end;height:100%">' +
              '<strong style="color:#fff;font-size:0.8rem">' + escapeHtml(tile.title || 'Untitled') + '</strong>' +
              (tile.description ? '<span style="color:rgba(255,255,255,0.8);font-size:0.7rem;margin-top:4px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">' + escapeHtml(tile.description) + '</span>' : '') +
            '</div>' +
          '</div>';
        }

        const iconSvg = PREVIEW_ICON_MAP[tile.icon] || PREVIEW_ICON_MAP.scale;
        return '<div style="grid-column:' + span + ';min-height:' + h + ';border-radius:16px;background:rgba(255,255,255,0.6);backdrop-filter:blur(12px);border:1px solid rgba(0,0,0,0.06);padding:16px;display:flex;flex-direction:column;justify-content:space-between">' +
          '<div style="color:#1d1d1f">' + iconSvg + '</div>' +
          '<div>' +
            '<strong style="font-size:0.8rem;color:#1d1d1f">' + escapeHtml(tile.title || 'Untitled') + '</strong>' +
            (tile.description ? '<p style="font-size:0.7rem;color:#86868b;margin:4px 0 0;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">' + escapeHtml(tile.description) + '</p>' : '') +
          '</div>' +
        '</div>';
      }).join('');
    }

    document.getElementById("btnAddTile").addEventListener("click", () => {
      const tiles = loadBentoTiles();
      if (tiles.length >= MAX_TILES) { showToast("Maximum of " + MAX_TILES + " tiles"); return; }
      tiles.push({ id: generateId(), title: "", description: "", icon: "scale", layout: "medium", displayMode: "icon", bgImage: "" });
      localStorage.setItem("bentoTiles", JSON.stringify(tiles));
      renderBentoEditors();
      showToast("Tile added");
    });

    document.getElementById("saveBentoTiles").addEventListener("click", () => {
      const tiles = collectTilesFromEditors();
      localStorage.setItem("bentoTiles", JSON.stringify(tiles));
      console.log("Bento tiles saved:", tiles);
      showToast("Homepage layout saved");
    });

    renderBentoEditors();

    /* ══════════════════════════════════════════════
       Posts CRUD
       ══════════════════════════════════════════════ */

    function renderPostList() {
      const container = document.getElementById("postList");
      const posts = getPosts();

      if (posts.length === 0) {
        container.innerHTML = '<div class="empty-state">No posts yet. Click "Add New Post" to get started.</div>';
        return;
      }

      container.innerHTML = posts.map((p) => {
        const badges = [];
        if (p.published) {
          badges.push('<span class="badge published">Published</span>');
        } else {
          badges.push('<span class="badge draft">Draft</span>');
        }
        if (p.category) badges.push('<span class="badge category-badge">' + escapeHtml(p.category) + '</span>');
        return '<div class="page-row" data-id="' + p.id + '">' +
          '<div class="page-row-info">' +
            '<div class="page-row-title">' + escapeHtml(p.title) + '</div>' +
            '<div class="page-row-slug">' + escapeHtml(p.date || '') + '</div>' +
          '</div>' +
          '<div class="page-row-badges">' + badges.join('') + '</div>' +
          '<div class="page-row-actions">' +
            '<button class="btn btn-secondary btn-sm btn-edit-post">Edit</button>' +
            '<button class="btn btn-danger btn-sm btn-delete-post">Delete</button>' +
          '</div>' +
        '</div>';
      }).join('');

      container.querySelectorAll(".btn-edit-post").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.closest(".page-row").dataset.id;
          editPost(id);
        });
      });

      container.querySelectorAll(".btn-delete-post").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.closest(".page-row").dataset.id;
          deletePost(id);
        });
      });
    }

    const postFormPanel = document.getElementById("postFormPanel");
    const postListPanel = document.getElementById("postListPanel");

    function showPostForm() {
      postFormPanel.classList.add("visible");
      postListPanel.style.display = "none";
    }

    function hidePostForm() {
      postFormPanel.classList.remove("visible");
      postListPanel.style.display = "";
      clearPostForm();
    }

    function clearPostForm() {
      document.getElementById("postEditId").value = "";
      document.getElementById("postTitleInput").value = "";
      document.getElementById("postSlugInput").value = "";
      document.getElementById("postDateInput").value = "";
      document.getElementById("postCategoryInput").value = "News";
      document.getElementById("postContentInput").value = "";
      document.getElementById("postPublished").checked = true;
      document.getElementById("postFormTitle").textContent = "Add New Post";
    }

    // Auto-generate slug from title
    document.getElementById("postTitleInput").addEventListener("input", (e) => {
      const slugField = document.getElementById("postSlugInput");
      const editId = document.getElementById("postEditId").value;
      if (!editId) {
        slugField.value = e.target.value
          .toLowerCase()
          .replace(/[^a-z0-9\s-]/g, "")
          .replace(/\s+/g, "-")
          .replace(/-+/g, "-")
          .replace(/^-|-$/g, "");
      }
    });

    document.getElementById("btnAddPost").addEventListener("click", () => {
      clearPostForm();
      // Default date to today
      document.getElementById("postDateInput").value = new Date().toISOString().split("T")[0];
      showPostForm();
    });

    document.getElementById("btnCancelPost").addEventListener("click", hidePostForm);

    document.getElementById("btnSavePost").addEventListener("click", () => {
      const title = document.getElementById("postTitleInput").value.trim();
      const slug = document.getElementById("postSlugInput").value.trim()
        .toLowerCase().replace(/[^a-z0-9-]/g, "");
      const date = document.getElementById("postDateInput").value;
      const category = document.getElementById("postCategoryInput").value;
      const content = document.getElementById("postContentInput").value;
      const published = document.getElementById("postPublished").checked;
      const editId = document.getElementById("postEditId").value;

      if (!title) { showToast("Title is required"); return; }
      if (!slug) { showToast("Slug is required"); return; }

      const posts = getPosts();

      const duplicate = posts.find((p) => p.slug === slug && p.id !== editId);
      if (duplicate) { showToast("A post with this slug already exists"); return; }

      if (editId) {
        const idx = posts.findIndex((p) => p.id === editId);
        if (idx !== -1) {
          posts[idx].title = title;
          posts[idx].slug = slug;
          posts[idx].date = date;
          posts[idx].category = category;
          posts[idx].content = content;
          posts[idx].published = published;
        }
        showToast("Post updated");
      } else {
        const now = new Date();
        const dateStr = now.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" });
        posts.push({
          id: generateId(),
          title: title,
          slug: slug,
          date: date,
          category: category,
          content: content,
          published: published,
          createdAt: dateStr
        });
        showToast("Post created");
      }

      savePosts(posts);
      hidePostForm();
      renderPostList();
      refreshDashboard();
    });

    function editPost(id) {
      const posts = getPosts();
      const post = posts.find((p) => p.id === id);
      if (!post) return;

      document.getElementById("postEditId").value = post.id;
      document.getElementById("postTitleInput").value = post.title;
      document.getElementById("postSlugInput").value = post.slug;
      document.getElementById("postDateInput").value = post.date || "";
      document.getElementById("postCategoryInput").value = post.category || "News";
      document.getElementById("postContentInput").value = post.content || "";
      document.getElementById("postPublished").checked = post.published;
      document.getElementById("postFormTitle").textContent = "Edit Post";

      showPostForm();
    }

    function deletePost(id) {
      const posts = getPosts();
      const post = posts.find((p) => p.id === id);
      if (!post) return;

      if (!confirm('Delete "' + post.title + '"? This cannot be undone.')) return;

      const updated = posts.filter((p) => p.id !== id);
      savePosts(updated);
      renderPostList();
      refreshDashboard();
      showToast("Post deleted");
    }

    /* ══════════════════════════════════════════════
       Staff CRUD
       ══════════════════════════════════════════════ */

    function renderStaffList() {
      const container = document.getElementById("staffList");
      const staff = getStaff();

      if (staff.length === 0) {
        container.innerHTML = '<div class="empty-state">No staff yet. Click "Add Staff Member" to get started.</div>';
        return;
      }

      container.innerHTML = staff.map((s) => {
        const badges = [];
        if (s.showOnWebsite !== false) {
          badges.push('<span class="badge published">Visible</span>');
        } else {
          badges.push('<span class="badge draft">Hidden</span>');
        }
        if (s.hiring) badges.push('<span class="badge published">Hiring</span>');
        badges.push('<span class="badge nav-badge">' + escapeHtml(s.office) + '</span>');
        return '<div class="page-row" data-id="' + s.id + '">' +
          '<div class="page-row-info">' +
            '<div class="page-row-title">' + escapeHtml(s.name) + '</div>' +
            '<div class="page-row-slug">' + escapeHtml(s.title) + '</div>' +
          '</div>' +
          '<div class="page-row-badges">' + badges.join('') + '</div>' +
          '<div class="page-row-actions">' +
            '<button class="btn btn-secondary btn-sm btn-edit-staff">Edit</button>' +
            '<button class="btn btn-danger btn-sm btn-delete-staff">Delete</button>' +
          '</div>' +
        '</div>';
      }).join('');

      container.querySelectorAll(".btn-edit-staff").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.closest(".page-row").dataset.id;
          editStaffMember(id);
        });
      });

      container.querySelectorAll(".btn-delete-staff").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.closest(".page-row").dataset.id;
          deleteStaffMember(id);
        });
      });
    }

    const staffFormPanel = document.getElementById("staffFormPanel");
    const staffListPanel = document.getElementById("staffListPanel");

    function showStaffForm() {
      staffFormPanel.classList.add("visible");
      staffListPanel.style.display = "none";
    }

    function hideStaffForm() {
      staffFormPanel.classList.remove("visible");
      staffListPanel.style.display = "";
      clearStaffForm();
    }

    function clearStaffForm() {
      document.getElementById("staffEditId").value = "";
      document.getElementById("staffNameInput").value = "";
      document.getElementById("staffTitleInput").value = "";
      document.getElementById("staffOfficeInput").value = "Berkeley";
      document.getElementById("staffImageInput").value = "";
      document.getElementById("staffEmailInput").value = "";
      document.getElementById("staffPhoneInput").value = "";
      document.getElementById("staffBioInput").value = "";
      document.getElementById("staffShowOnWebsite").checked = true;
      document.getElementById("staffHiring").checked = false;
      document.getElementById("staffFormTitle").textContent = "Add Staff Member";
    }

    document.getElementById("btnAddStaff").addEventListener("click", () => {
      clearStaffForm();
      showStaffForm();
    });

    document.getElementById("btnCancelStaff").addEventListener("click", hideStaffForm);

    document.getElementById("btnSaveStaff").addEventListener("click", () => {
      const name = document.getElementById("staffNameInput").value.trim();
      const title = document.getElementById("staffTitleInput").value.trim();
      const office = document.getElementById("staffOfficeInput").value;
      const imageUrl = document.getElementById("staffImageInput").value.trim();
      const email = document.getElementById("staffEmailInput").value.trim();
      const phone = document.getElementById("staffPhoneInput").value.trim();
      const bio = document.getElementById("staffBioInput").value;
      const showOnWebsite = document.getElementById("staffShowOnWebsite").checked;
      const hiring = document.getElementById("staffHiring").checked;
      const editId = document.getElementById("staffEditId").value;

      if (!name) { showToast("Name is required"); return; }
      if (!title) { showToast("Title is required"); return; }

      const staff = getStaff();

      if (editId) {
        const idx = staff.findIndex((s) => s.id === editId);
        if (idx !== -1) {
          staff[idx].name = name;
          staff[idx].title = title;
          staff[idx].office = office;
          staff[idx].imageUrl = imageUrl;
          staff[idx].email = email;
          staff[idx].phone = phone;
          staff[idx].bio = bio;
          staff[idx].showOnWebsite = showOnWebsite;
          staff[idx].hiring = hiring;
        }
        showToast("Staff member updated");
      } else {
        const now = new Date();
        const dateStr = now.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" });
        staff.push({
          id: generateId(),
          name: name,
          title: title,
          office: office,
          imageUrl: imageUrl,
          email: email,
          phone: phone,
          bio: bio,
          showOnWebsite: showOnWebsite,
          hiring: hiring,
          createdAt: dateStr
        });
        showToast("Staff member added");
      }

      saveStaff(staff);
      hideStaffForm();
      renderStaffList();
      refreshDashboard();
    });

    function editStaffMember(id) {
      const staff = getStaff();
      const member = staff.find((s) => s.id === id);
      if (!member) return;

      document.getElementById("staffEditId").value = member.id;
      document.getElementById("staffNameInput").value = member.name;
      document.getElementById("staffTitleInput").value = member.title;
      document.getElementById("staffOfficeInput").value = member.office || "Berkeley";
      document.getElementById("staffImageInput").value = member.imageUrl || "";
      document.getElementById("staffEmailInput").value = member.email || "";
      document.getElementById("staffPhoneInput").value = member.phone || "";
      document.getElementById("staffBioInput").value = member.bio || "";
      document.getElementById("staffShowOnWebsite").checked = member.showOnWebsite !== false;
      document.getElementById("staffHiring").checked = member.hiring || false;
      document.getElementById("staffFormTitle").textContent = "Edit Staff Member";

      showStaffForm();
    }

    function deleteStaffMember(id) {
      const staff = getStaff();
      const member = staff.find((s) => s.id === id);
      if (!member) return;

      if (!confirm('Delete "' + member.name + '"? This cannot be undone.')) return;

      const updated = staff.filter((s) => s.id !== id);
      saveStaff(updated);
      renderStaffList();
      refreshDashboard();
      showToast("Staff member deleted");
    }

    /* ══════════════════════════════════════════════
       Media Library
       ══════════════════════════════════════════════ */

    function getMediaLibrary() {
      try {
        return JSON.parse(localStorage.getItem("mediaLibrary") || "[]");
      } catch (e) {
        return [];
      }
    }

    function saveMediaLibrary(items) {
      localStorage.setItem("mediaLibrary", JSON.stringify(items));
    }

    function renderMediaList() {
      const container = document.getElementById("mediaList");
      const items = getMediaLibrary();

      if (items.length === 0) {
        container.innerHTML = '<div class="empty-state">No media yet. Click "Add Image URL" to get started.</div>';
        return;
      }

      container.innerHTML = items.map((item) => {
        return '<div class="media-row" data-id="' + item.id + '">' +
          '<img class="media-thumb" src="' + escapeHtml(item.url) + '" alt="' + escapeHtml(item.label) + '" onerror="this.style.display=\'none\'">' +
          '<div class="media-info">' +
            '<div class="media-label">' + escapeHtml(item.label || "Untitled") + '</div>' +
            '<div class="media-url">' + escapeHtml(item.url) + '</div>' +
          '</div>' +
          '<div class="media-actions">' +
            '<button class="btn btn-secondary btn-sm btn-copy-url">Copy URL</button>' +
            '<button class="btn btn-danger btn-sm btn-delete-media">Delete</button>' +
          '</div>' +
        '</div>';
      }).join('');

      // Bind copy buttons
      container.querySelectorAll(".btn-copy-url").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.closest(".media-row").dataset.id;
          const items = getMediaLibrary();
          const item = items.find((m) => m.id === id);
          if (item) {
            navigator.clipboard.writeText(item.url).then(() => {
              showToast("URL copied to clipboard");
            }).catch(() => {
              showToast("Failed to copy URL");
            });
          }
        });
      });

      // Bind delete buttons
      container.querySelectorAll(".btn-delete-media").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.closest(".media-row").dataset.id;
          const items = getMediaLibrary();
          const updated = items.filter((m) => m.id !== id);
          saveMediaLibrary(updated);
          renderMediaList();
          showToast("Media deleted");
        });
      });
    }

    const mediaForm = document.getElementById("mediaForm");

    document.getElementById("btnAddMedia").addEventListener("click", () => {
      document.getElementById("mediaUrlInput").value = "";
      document.getElementById("mediaLabelInput").value = "";
      mediaForm.classList.add("visible");
    });

    document.getElementById("btnCancelMedia").addEventListener("click", () => {
      mediaForm.classList.remove("visible");
    });

    document.getElementById("btnSaveMedia").addEventListener("click", () => {
      const url = document.getElementById("mediaUrlInput").value.trim();
      const label = document.getElementById("mediaLabelInput").value.trim();

      if (!url) { showToast("URL is required"); return; }

      const items = getMediaLibrary();
      items.push({
        id: generateId(),
        url: url,
        label: label || "Untitled"
      });
      saveMediaLibrary(items);
      mediaForm.classList.remove("visible");
      renderMediaList();
      showToast("Media added");
    });

    renderMediaList();

    /* ══════════════════════════════════════════════
       Init
       ══════════════════════════════════════════════ */

    renderPageList();
    renderPostList();
    renderStaffList();
    refreshDashboard();
  </script>
</body>
</html>
